{
	"name": "FT_diaria_optim",
	"properties": {
		"content": {
			"query": "CREATE VIEW dbo.vw_ft_clim_diario AS\nWITH \nTEMP AS (\n    SELECT \n    CAST( time as date ) as fecha\n    , CodigoNAcional as estacion \n    , max(ts_valor) as max_temp \n    , min(ts_valor) as min_temp \n    , max(ts_valor) - min(ts_valor) as var_temp\n    , round( avg(ts_valor),2) as med_temp\n    FROM dbo.temperatura\n    group by CAST( time as date ), CodigoNAcional \n), \nVIENTO AS (\n    SELECT\n    CAST ( time as date) as fecha\n    , CodigoNacional as estacion \n    , MAX(ff_Valor) as max_vvel\n    , MIN(ff_Valor) as min_vvel\n    FROM dbo.viento\n    GROUP by cast( time as date), CodigoNacional\n    ),\nHUMEDAD AS (\n    SELECT\n      CAST ( time as date) as fecha\n    , CodigoNacional as estacion \n    , COALESCE(MAX(HR_Valor),0) AS max_hum\n    , COALESCE(MIN(HR_Valor),0) AS min_hum\n    , COALESCE(ROUND(AVG(HR_Valor),2),0) AS med_hum\n    FROM dbo.humedad\n    GROUP BY CAST( time as date ), CodigoNAcional \n)\nSELECT \n  COALESCE ( t.fecha , h.fecha , v.fecha) as fecha\n, COALESCE ( t.estacion , h.estacion , h.estacion) as estacion\n, t.max_temp\n, t.min_temp\n, t.var_temp\n, t.med_temp\n,COALESCE( v.max_vvel , 0) max_vvel\n,COALESCE( v.min_vvel , 0) min_vvel\n,COALESCE( h.max_hum , 0) max_hum\n,COALESCE( h.min_hum , 0) min_hum\nFROM  TEMP T \n    FULL JOIN VIENTO V  ON T.fecha= V.fecha AND T.estacion = v.estacion\n    FULL JOIN HUMEDAD H ON t.fecha= h.fecha and t.estacion = h.estacion\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "clima_cl",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}